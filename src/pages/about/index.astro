---
import links from 'public/links.json'
import config from 'virtual:config'

import { Image } from 'astro:assets';
import mpQrCode from '@/assets/mp-qr-code.jpg';
import doudou from '@/assets/doudou.jpeg'

import { Comment } from 'astro-pure/advanced'
import { Collapse, Spoiler, Timeline } from 'astro-pure/user'
import PageLayout from '@/layouts/CommonPage.astro'
import Substats from '@/components/about/Substats.astro'
import ToolSection from '@/components/about/ToolSection.astro'
import FriendList from '@/components/links/FriendList.astro'
import BooksDisplay from '@/components/BooksDisplay.astro';

// 页面标题配置
const headings = [
  { depth: 2, slug: 'hobbies', text: 'Hobbies' },
  { depth: 2, slug: 'tools', text: 'Tools' },
  { depth: 2, slug: 'social-networks', text: 'Social Networks' },
  { depth: 2, slug: 'gossips', text: 'Gossips' },
  { depth: 2, slug: 'about-blog', text: 'About Blog' }
]

const { friends } = links
const linksConf = config.integ.links
---

<PageLayout title='About Me 关于我' {headings} info='/about'>

  <p>👏 Welcome to my blog! 欢迎来到我的博客～</p>
  <p style="line-height: 2;">
    相见即是缘分！欢迎来到这里。<br/>
    🧰 工具控，爱折腾。熟练掌握 <strong>Notion、Obsidian</strong> 等工具。
    喜欢很多美丽而“无用”的事物， <strong>📖 书籍 & 🎬 电影 & 🎵 音乐</strong>，
    希望在这个世界寻找一点乐趣，也<strong>「诚心祝福你，捱得到新天地」</strong>。<br/>
    如果你是新朋友，欢迎查看更多关于我的信息～欢迎扫描下方二维码关注我的公众号 👇
  </p>
  
  <!-- 公众号二维码：优化手机端自适应 -->
  <div style="text-align: center; margin: 15px 0;">
    <Image 
      src={mpQrCode} 
      width="200" 
      alt="公众号二维码" 
      class="mx-auto max-w-[80vw]"
      loading="lazy"
    />
  </div>

  <p>
    如果有更多想说的，也可以 📮 <a href="mailto:joeytoday247@outmail.com">给我发邮件</a>
    <Spoiler> 🎉 这里是彩蛋内容：祝你今日开心！</Spoiler>
  </p>
  
  {/* 音乐播放器：移动端隐藏（核心修改：添加 media-player-container 类） */}
  <div class="media-player-container">
    <p>🎵 接下来可以听着音乐继续看：</p>
    <div style="
      width: 100%; 
      max-width: 700px; 
      margin: 15px auto 0; 
      padding: 0;
      box-sizing: border-box;
      position: relative;
      min-width: 280px;
    ">
      <!-- 网易云歌单iframe -->
      <div>
        <iframe 
          src="https://music.163.com/outchain/player?type=0&id=13382956851&auto=0&height=280" 
          style="
            border: 1px solid #eee; 
            width: 100%; 
            height: 280px; 
            display: block; 
            border-radius: 8px;
            min-height: 260px;
            pointer-events: auto;
          "
          frameborder="0"
          allow="autoplay; encrypted-media"
          allowfullscreen="false"
          loading="lazy"
          title="我的音乐清单"
          sandbox="allow-scripts allow-same-origin allow-popups allow-pointer-lock"
          scrolling="no"
        ></iframe>
      </div>

      <!-- 加载状态提示 -->
      <div id="musicLoader" style="
        position: absolute; 
        top: 0; 
        left: 0; 
        right: 0; 
        bottom: 0; 
        background: #fff; 
        border-radius: 8px; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-size: 14px; 
        color: #666;
        z-index: 1;
        opacity: 1;
        transition: opacity 0.3s ease;
      ">
        音乐清单加载中...</div>

      <!-- 手机端提示（移动端会随播放器一起隐藏，无需额外处理） -->
      <p style="
        text-align: center; 
        font-size: 12px; 
        color: #888; 
        margin: 8px 0 0;
        padding: 0 10px;
      ">
        点击播放按钮，可切换歌单内歌曲 🎵
      </p>
    </div>

    <!-- 音乐播放器加载控制脚本 
    解决TypeScript类型错误和移动端加载问题
    包含多重加载检测机制和超时处理
    -->
    <script>
      // 类型断言为HTMLIFrameElement解决类型错误
      const musicIframe = document.querySelector('iframe[src*="music.163.com"]') as HTMLIFrameElement;
      const musicLoader = document.getElementById('musicLoader');

      if (musicIframe && musicLoader) {
        // 监听iframe加载完成事件
        musicIframe.onload = function() {
          musicLoader.style.opacity = '0';
          setTimeout(() => {
            musicLoader.style.display = 'none';
          }, 300);
        };

        // 定期检查iframe内容加载状态
        const checkIframeLoaded = setInterval(() => {
          try {
            if (musicIframe.contentWindow && musicIframe.contentWindow.document.body) {
              musicLoader.style.opacity = '0';
              setTimeout(() => {
                musicLoader.style.display = 'none';
              }, 300);
              clearInterval(checkIframeLoaded);
            }
          } catch (e) {}
        }, 500);

        // 超时处理机制
        setTimeout(() => {
          if (musicLoader.style.display !== 'none') {
            musicLoader.innerHTML = '加载超时，点击刷新重试';
            musicLoader.style.color = '#ff4444';
            musicLoader.style.cursor = 'pointer';
            musicLoader.addEventListener('click', () => {
              musicIframe.src = musicIframe.src;
              musicLoader.innerHTML = '重新加载中...';
              musicLoader.style.color = '#666';
            });
          }
          clearInterval(checkIframeLoaded);
        }, 8000);
      }
    </script>
  </div>


  {/* 个人爱好部分 */}
  <h2 id='hobbies'>Hobbies 我的爱好</h2>
  <ul>
    <li>📖 喜欢阅读与电影，经常写随笔，也经常放鸽子。看不到我的随笔，也欢迎看看👉<a href="https://note.joeytoday.com/">📒 我的笔记</a></li>
    <li>✈️ 喜欢宅家，但也爱旅行，若有喜爱的朋友相伴，是美事一桩～</li>
    <li>🎈 日常 J 人，出门就变 P，主打一个什么都行，开心就好!</li>
    <li>🎵 很爱音乐，只要好听！这里是我的推荐，如果你也想听听看～👉<a href="https://joeytoday.notion.site/music">joeytoday的歌单</a></li>
    <li>🐈 家有傲娇小猫，名曰「兜兜」，不粘人但喜欢人，喜欢被拍拍，但最喜欢我（我自封），附上兜兜美照。</li>
  </ul>

  {/* 小猫图片展示 */}
  <div style="text-align: center; margin: 15px 0; padding: 0 10px;">
    <Image 
      src={doudou} 
      width="700" 
      alt="小猫兜兜" 
      class="mx-auto max-w-full"
      loading="lazy"
      style="border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
    />
  </div>

  {/* 书籍电影卡片 */}
  <BooksDisplay />

  {/* 工具展示部分 */}
  <h2 id='tools'>Tools 我的工具</h2>
  <p>Current support tools as follow:</p>

  <ToolSection
    class='mb-5'
    title='Productivity'
    tools={[
      {
        name: 'Notion',
        description: '个人系统｜书影管理｜项目管理',
        href: 'https://joeytoday.notion.site/',
        icon: import('@/assets/tools/notion.svg?raw')
      },
      {
        name: 'Obsidian',
        description: '写作｜日记｜笔记｜思考',
        href: 'https://joeyposts.vercel.app/',
        icon: import('@/assets/tools/obsidian.svg?raw')
      },
      {
        name: '微信读书',
        description: '丰富书库｜随处阅读',
        href: 'https://weread.qq.com/',
        icon: import('@/assets/tools/weread-logo.svg?raw')
      },
      {
        name: 'Readwise Reader',
        description: '网络文章稍后读｜订阅 RSS 源',
        href: 'https://readwise.io/read',
        icon: import('@/assets/tools/readwise-logo.svg?raw')
      },
      {
        name: 'Calflow',
        description: '时间记录｜日程管理｜原生 iOS 支持',
        href: 'https://calflow.app/',
        icon: import('@/assets/tools/calflow-logo.svg?raw')
      },
      {
        name: 'flomo',
        description: '碎片化记录｜洞察回顾｜灵感思考',
        href: 'https://flomoapp.com/',
        icon: import('@/assets/tools/flomo-logo.svg?raw')
      }
    ]}
  />

  <ToolSection
    class='mb-5'
    title='Device'
    tools={[
      {
        name: '💻 MacBook Air M3',
        description: 'Personal computer 个人电脑',
        href: 'https://support.apple.com/zh-cn/118551',
        icon: import('@/assets/tools/apple.svg?raw')
      },
      {
        name: '📱 iPhone 14 Pro',
        description: '使用手机',
        href: 'https://support.apple.com/zh-cn/111849',
        icon: import('@/assets/tools/iPhone.svg?raw')
      },
      {
        name: '📖 iReader Ocean 3 Turbo',
        description: '阅读电子书',
        href: 'https://item.jd.com/100046103416.html',
        icon: import('@/assets/tools/iReader.svg?raw')
      },
      {
        name: '📷 Fuji XT30-II',
        description: '日常使用相机',
        href: 'https://www.fujifilm-x.com/zh-cn/products/cameras/x-t30-ii/',
        icon: import('@/assets/tools/fuji.svg?raw')
      }
    ]}
  />


  {/* 社交媒体部分 */}
  <h2 id='social-networks'>Social Networks 社交媒体</h2>
  <p>
    👏 欢迎关注～有什么想说的，也可以 💬 <a href="https://www.notion.so/joeytoday/310f5493daf44d82a0599d2c034100cb">给我留言</a>
  </p>

  <FriendList list={friends[3]} />

  {/* 碎碎念部分 */}
  <h2 id='gossips'>Gossips 碎碎念</h2>
  <Collapse title='碎碎念'>
    其实这里的文字只是为了凑这个模块，嘿嘿，看来你打开了这里 😊
  </Collapse>

  {/* 关于博客部分 */}
  <h2 id='about-blog'>About Blog 关于此博客</h2>
  <p>
    本站出于我一时的热情建立，熬了两个通宵终于初步完成了，希望能成为我记录生活的开始。</br>
    有点类似千禧年代的互联网精神，开源的、互联的，现在想来有点浪漫～</br>
    搭建有点辛苦，但过程很开心，希望各位网友也阅读开心！🎉 撒花
  </p>

  <Collapse title='Website history'>
    <Timeline events={linksConf.logbook} />
  </Collapse>
  

  {/* 评论系统 */}
  <Comment slot='bottom' />

  {/* 核心：CSS媒体查询 - 移动端隐藏音乐播放器 */}
  <style>
    /* 屏幕宽度 ≤ 768px（手机端）时，隐藏整个音乐播放器容器 */
    @media (max-width: 768px) {
      .media-player-container {
        display: none !important; /* !important 确保不被其他样式覆盖 */
      }
    }

    /* 屏幕宽度 > 768px（PC端/平板横屏）时，正常显示（默认样式，可省略） */
    @media (min-width: 769px) {
      .media-player-container {
        display: block;
      }
    }
  </style>
</PageLayout>